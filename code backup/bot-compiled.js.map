{"version":3,"sources":["bot.js"],"names":[],"mappings":"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","file":"bot-compiled.js","sourcesContent":["'use strict';\r\n\r\n// Weather Example\r\n// See https://wit.ai/sungkim/weather/stories and https://wit.ai/docs/quickstart\r\n//const Wit = require('node-wit').Wit;\r\nconst FB = require('./facebook.js');\r\nconst Config = require('./../config/const.js');\r\nconst Search = require('./logics.js');\r\nconst lContext =  require('./localContexts.js');\r\nconst Sessions = require('./sessions.js');\r\nvar http = require('http');\r\nvar Semantics = require('../semantics/check.js');\r\nconst  Messages = require('./messages.js');\r\nconst  witRequest = require('./request.js');\r\n// const mongoDB = require('./mongodb/update_mongo.js');\r\nvar watson = require('watson-developer-cloud');\r\nconst Helper = require('./helper.js');\r\nconst Mappings = require('./mapping.js');\r\nconst functions = require('./functions.js');\r\nvar async = require('async');\r\nvar winston = require('winston');\r\nconst  witAPIs  = require('./witAPIS.js');\r\nconst global = require('./global.js');\r\nconst db=require('./pushintodb.js');\r\nvar moment=require('moment');\r\n\r\n\r\nfunction getAllEntities(sessionId, context, entities, message,callback){\r\n\r\n    // Store entities in context\r\n\r\n    var localContext = lContext.userContext(sessionId);\r\n\r\n\r\n    Helper.printEntityListFromWit(entities);\r\n    context = Helper.storeValInContext(context, \"entity_list\", entities,sessionId);\r\n    context = Helper.addDirectEntitiesToContext(context, entities, sessionId);\r\n\r\n\r\n    var features = Helper.firstEntityValue(entities,\"features\");\r\n    if(features && context.mobile)\r\n        lContext.storeNewSessionKey(sessionId,\"feature_pref\",[features]);\r\n    if(features)\r\n        context = Helper.storeValInContext(context, \"features\", features, sessionId);\r\n\r\n    var intent = Helper.firstEntityValue(entities,\"intent\");\r\n  //  if(intent && context.mobile)\r\n    //    lContext.storeNewSessionKey(sessionId,\"feature_pref\",[intent]);\r\n\r\n    if(intent)\r\n        context = Helper.storeValInContext(context, \"intent\", intent, sessionId);\r\n\r\n    if(context.attribute)   {\r\n        var attribute_list = Helper.allEntityValue(entities,'attribute');\r\n        context = Helper.storeValInContext(context,\"attribute_list\",attribute_list,sessionId);\r\n    }\r\n    \r\n    var query = Helper.firstEntityValue(entities,\"query\");\r\n    if(query){\r\n        if(query == \"what\") context = Helper.storeValInContext(context,\"what\",\"what\",sessionId);\r\n        if(query == \"why\") context = Helper.storeValInContext(context,\"why\",\"why\",sessionId);\r\n        if(query == \"how\") context = Helper.storeValInContext(context,\"how\",\"how\",sessionId);\r\n        if(query == \"does\") context = Helper.storeValInContext(context,\"does\",\"does\",sessionId);\r\n    }\r\n    \r\n    if(context.units){\r\n        if(context.attribute)\r\n            context = Helper.storeValInContext(context,\"attribute\",context.attribute,sessionId);\r\n        if(context.price_range)\r\n            context = Helper.storeValInContext(context,\"attribute_filter\",context.price_range,sessionId);\r\n        else\r\n            context = Helper.storeValInContext(context,\"attribute_filter\",\"above\",sessionId);\r\n    }\r\n\r\n    context = Helper.definePriceRange(message, context, sessionId);\r\n\r\n    var in_list = Helper.firstEntityValue(entities,\"list_entity\");\r\n    var yes_no = Helper.firstEntityValue(entities,\"yes_no\");\r\n    if(yes_no)\r\n        context = Helper.storeValInContext(context,\"yes_no\",yes_no,sessionId);\r\n\r\n    var brand = Helper.firstEntityValue(entities,\"brand\");\r\n    if(brand){\r\n        context = Helper.storeValInContext(context,\"brand\",brand,sessionId);\r\n        if(!Helper.isKeyExists(\"brand_pref\",localContext.sessionVars))\r\n            lContext.storeNewSessionKey(sessionId,\"brand_pref\",[]);\r\n    }\r\n\r\n    if(context.clear){\r\n        context = {};\r\n        context = Helper.storeValInContext(context,\"clear\",context.clear,sessionId);\r\n    }\r\n    if(context.intent == \"trivia\"){\r\n        context = {};\r\n        context = Helper.storeValInContext(context,\"trivia\",message,sessionId);\r\n    }\r\n\r\n    console.log(\"--------------generated context--------------------\");\r\n    console.log(context);\r\n    console.log(\"---------------------------------------------------\");\r\n\r\n    message = message.toLowerCase();\r\n    Helper.getSKUAlias(message,function(data) {\r\n        var skuList = data[\"skus\"];\r\n        var aliasList = data['aliases'];\r\n        if(( Helper.isKeyExists(\"compare\",context) || Helper.isKeyExists(\"better\",context))\r\n            && skuList.length >=2 ){\r\n            context = Helper.storeValInContext(context, \"sku1\", skuList[0], sessionId);\r\n            context = Helper.storeValInContext(context, \"sku2\", skuList[1], sessionId);\r\n            delete context.sku;\r\n            for(var j in aliasList)\r\n                message = message.replace(aliasList[j],\"\");\r\n        } else if(skuList.length != 0 ) {\r\n            context = Helper.storeValInContext(context, \"sku\", skuList[0], sessionId);\r\n        }\r\n\r\n        for(var i in Mappings.noNoWords) {\r\n            var nonoword = Mappings.noNoWords[i];\r\n            if(wordInString(message,nonoword)) {\r\n                context = {};\r\n                context = Helper.storeValInContext(context,\"complex_sentence\",nonoword,sessionId);\r\n                break;\r\n            }\r\n        }\r\n\r\n        for(var i in Mappings.noNoWordOr) {\r\n            var nonoword = Mappings.noNoWordOr[i];\r\n            if(wordInString(message,nonoword)) {\r\n                if(!(Helper.isKeyExists(\"sku1\",context) && Helper.isKeyExists(\"sku2\",context))) {\r\n                    context = {};\r\n                    context = Helper.storeValInContext(context,\"complex_sentence\",nonoword,sessionId);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for(var i in Mappings.noNoWordNo) {\r\n            var nonoword = Mappings.noNoWordNo[i];\r\n            if(wordInString(message,nonoword)) {\r\n                if(message.toLowerCase() != \"no\" && message.toLowerCase() != \"n\") {\r\n                    context = {};\r\n                    context = Helper.storeValInContext(context,\"complex_sentence\",nonoword,sessionId);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        // var nonoword;\r\n        // if (Mappings.noNoWordOr.some(function(v) {\r\n        //         if(message.indexOf(v) > -1) nonoword = v;\r\n        //         return message.indexOf(\" \" + v + \" \") >= 0; })) {\r\n        //     console.log(\"Banned word is in the function\");\r\n        //     if(!(Helper.isKeyExists(\"sku1\",context) && Helper.isKeyExists(\"sku2\",context))) {\r\n        //         context = {};\r\n        //         context = Helper.storeValInContext(context,\"complex_sentence\",nonoword,sessionId,true);\r\n        //     }\r\n        // }\r\n        // if (Mappings.noNoWordNo.some(function(v) {\r\n        //         if(message.indexOf(v) > -1) nonoword = v;\r\n        //         return message.indexOf(\" \" + v + \" \") >= 0; })) {\r\n        //     console.log(\"Banned word is in the function\");\r\n        //     if(message.toLowerCase() != \"no\" || message.toLowerCase() != \"n\") {\r\n        //         context = {};\r\n        //         context = Helper.storeValInContext(context,\"complex_sentence\",nonoword,sessionId,true);\r\n        //     }\r\n        // }\r\n        // if (Mappings.noNoWords.some(function(v) {\r\n        //         if(message.indexOf(v) > -1) nonoword = v;\r\n        //         return message.indexOf(\" \" + v + \" \") >= 0; })) {\r\n        //     context = {};\r\n        //     context = Helper.storeValInContext(context,\"complex_sentence\",nonoword,sessionId,true);\r\n        // }\r\n\r\n        if(!Helper.isKeyExists('clear',context) &&\r\n            !Helper.isKeyExists('profanity',context)) {\r\n            Helper.checkEntities(message,context, sessionId,entities, function (data) {\r\n                callback && callback(data);\r\n            });\r\n        }\r\n\r\n        else {\r\n            callback && callback(context);\r\n        }\r\n    });\r\n}\r\n\r\n// Bot actions\r\nconst actions = {\r\n\r\n    say(sessionId, context, messages) {\r\n\r\n        // Bot testing mode, run cb() and return\r\n        if (require.main === module) {\r\n            // cb();\r\n            return;\r\n        }\r\n        const recipientId = Sessions.findFBid(sessionId);\r\n        var localContext = lContext.userContext(sessionId);\r\n\r\n        if(recipientId && localContext !== undefined) {\r\n\r\n            messages = Helper.breakMessagesForFacebook(messages,'\\n');\r\n            messages = Helper.breakMessagesForFacebook(messages,'.');\r\n\r\n            async.eachSeries(messages,function(listItem,esNext){\r\n                if(listItem[\"type\"] === \"text\") {\r\n                    FB.fbMessage(recipientId, listItem[\"message\"], function(data){\r\n                        esNext();\r\n                    });\r\n                }\r\n                else if(listItem[\"type\"] === \"list\") {\r\n                    FB.fbGenericMessage(recipientId, listItem[\"message\"], function(data){\r\n                        esNext();\r\n                    });\r\n                }\r\n            })\r\n        }\r\n    },\r\n    merge(sessionId, context, entities, message,cb) {\r\n        // Retrieve the location entity and store it into a context field\r\n\r\n        var localContext = lContext.userContext(sessionId);\r\n        var fbId = Sessions.findFBid(sessionId);\r\n        lContext.storeNewKey(sessionId,\"user_message\",message);\r\n\r\n\r\n        getAllEntities(sessionId, context, entities, message,function(context){\r\n\r\n            console.log(\"-----------------entities_and_values context--------------------\");\r\n            console.log(context);\r\n            console.log(\"--------------------------------------------------\");\r\n\r\n            var functionName = functions.getFunctionName(context);\r\n            console.log(\"Running function : \" + functionName);\r\n            if(functionName != null) {\r\n                lContext.storeNewKey(sessionId,\"preFunction\",functionName);\r\n                lContext.storeNewKey(sessionId,\"prev_user_question\",context);\r\n            }\r\n\r\n            var final_context_function = {};\r\n            final_context_function[\"final_context\"]  = context;\r\n            final_context_function[\"bot_function\"] = functionName;\r\n            cb(final_context_function);\r\n        });\r\n    },\r\n    error(sessionId, context, error) {\r\n        console.log(error.message);\r\n        context.error = \"error\";\r\n    },\r\n\r\n    // lists main list , male and female phones list, similar\r\n    // phones and sort phone list.\r\n\r\n    ['findAllPhones'] (sessionId, context,source,cb){\r\n\r\n        var localContext = lContext.userContext(sessionId);\r\n        var spec_sort = {};\r\n        var spec_query = {};\r\n        var filter = {};\r\n        var query;\r\n        var list_reason_message;\r\n        var attribute_mapped;\r\n        var filter_list = [];\r\n        lContext.storeNewKey(sessionId,\"relevant_attribute\",[]);\r\n        var featureList = [];\r\n        if(Helper.isKeyExists(\"feature_pref\",localContext.sessionVars))\r\n            featureList = localContext.sessionVars.feature_pref;\r\n\r\n\r\n        if(Helper.isKeyExists('intent', context) ){\r\n            var key = context.intent.toLowerCase();\r\n            console.log(\" intent selection\",key);\r\n            var feature_pref_mapped = [];\r\n            if(key == \"phonelist_camera\")  feature_pref_mapped.push(\"camera\");\r\n            else if(key == \"phonelist_battery\")  feature_pref_mapped.push(\"battery\");\r\n            else if(key == \"phonelist_memory\")  feature_pref_mapped.push(\"memory\");\r\n            else if(key == \"phonelist_perform\")feature_pref_mapped.push(\"performance\");\r\n            else if(key == \"phonelist_front_camera\")  feature_pref_mapped.push(\"front camera resolution\");\r\n            console.log(feature_pref_mapped);\r\n            if(feature_pref_mapped.length > 0 ) {\r\n                delete context.intent;\r\n                lContext.storeNewSessionKey(sessionId,\"feature_pref\",feature_pref_mapped);\r\n            }\r\n            if(featureList.length == 0) {\r\n                spec_sort = Mappings.isSpecSortKeyExists(key) ? Mappings.specSortValue(key) : undefined;\r\n                list_reason_message = Mappings.isReasonExists(key) ? Mappings.getReasonMessage(key) : undefined;\r\n            }\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"start_price\",localContext.sessionVars) &&\r\n            Helper.isKeyExists(\"end_price\",localContext.sessionVars)) {\r\n            filter = {\r\n                'range': {\r\n                    'price': {\r\n                        'gte': localContext.sessionVars.start_price,\r\n                        'lte': localContext.sessionVars.end_price\r\n                    }\r\n                }\r\n            };\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"popular\",context)){\r\n            console.log(\"popular phone\");\r\n            spec_sort =  Mappings.specSortValue(\"popular\");\r\n            query =  {bool:{ \"must_not\":[ {\"match\":{\"popular\":0} }  ] } };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"brand\",context)){\r\n            console.log(\"brand phones\");\r\n            query = {bool:{\"must\":[{\"match\":{\"brand\":context.brand}}]} };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"os\",context)){\r\n            console.log(\"best os phone\");\r\n            spec_sort =  Mappings.specSortValue(\"os\");\r\n            query = {bool:{ \"must\":[{\"match\":{\"os\":context.os}}] }};\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"sim_type\",context)){\r\n            console.log(\"sim type phone\");\r\n            query = { bool:{\"must\":[{\"match\":{\"sim_type\":context.sim_type}}]} };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"network_support\",context)){\r\n            console.log(\"network support phone\");\r\n            query = { bool:{\"must\":[{\"match\":{\"network_support\":context.network_support}}]} };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"processor_type\",context)){\r\n            console.log(\"processor type  phones\");\r\n            query = {bool:{\"must\":[{\"match_phrase\":{\"processor_type\":context.processor_type}}]} };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"display_type\",context)){\r\n            console.log(\"display type phones\");\r\n            query = {bool:{\"must\":[{\"match_phrase\":{\"display_type\":context.display_type}}]} };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"sensor_type\",context)){\r\n            console.log(\"sensor type  phones\");\r\n            query = {bool:{\"must\":[{\"match_phrase\":{\"sensors\":context.sensor_type}}]} };\r\n            output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n\r\n        }\r\n\r\n        if(Helper.isKeyExists('phone_properties',context)){\r\n            console.log(\"phone property  phones\");\r\n            var key  = context.phone_properties.toLowerCase();\r\n            spec_sort  =  Mappings.isSpecSortKeyExists(key) ? Mappings.specSortValue(key) : undefined;\r\n            list_reason_message = Mappings.isReasonExists(key) ? Mappings.getReasonMessage(key) : undefined;\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"past_release\",context)){\r\n            var dates = Mappings.getPastTime(context.past_release);\r\n            filter = {\"and\":\r\n                [\r\n                    {\r\n                        \"range\": {\r\n                            \"announced_date\": {\"gte\": dates.start_time,\r\n                                \"lte\": dates.end_time}\r\n                        }\r\n                    },\r\n                    {\r\n                        \"range\":{\r\n                            \"price\":{\"gte\":localContext.sessionVars.start_price,\r\n                                \"lte\":localContext.sessionVars.end_price }\r\n                        }\r\n                    }\r\n                ]\r\n            };\r\n            output = Helper.addPrevQuery(sessionId, {}, filter, spec_query, filter);\r\n\r\n            spec_query = output[\"query\"];\r\n            filter = output[\"filter\"];\r\n        }\r\n\r\n        if(Helper.isKeyExists('attribute',context)){\r\n            var attribute_list = context.attribute_list;\r\n            for(var i in attribute_list) {\r\n                var attribute = attribute_list[i];\r\n                var filter_obj = {};\r\n                var attribute_preposition = null;\r\n                var attribute_quantity = null;\r\n                var attribute_values = Helper.allEntityValue(context.entity_list,attribute);\r\n                console.log(attribute);\r\n                console.log(context.entity_list);\r\n                console.log(\"Attribute values\");\r\n                console.log(attribute_values);\r\n\r\n                attribute_mapped = Mappings.isDbKeyExists(attribute.toLowerCase()) ?\r\n                    Mappings.getDbKey(attribute.toLowerCase()) : undefined;\r\n\r\n                // Extract if attribute values exist in entities\r\n                for(var j in attribute_values) {\r\n                    var value = attribute_values[j];\r\n                    if(['above', 'below', 'under', 'equal', 'between', 'any'].indexOf(value) > -1) {\r\n                        attribute_preposition = value;\r\n                    }\r\n                    else if (!isNaN(value)) {\r\n                        attribute_quantity = parseInt(value,10);\r\n                    }\r\n                }\r\n\r\n                // If attribute value filter exists\r\n                if(attribute_quantity != null) {\r\n                    if(attribute_preposition == \"above\"\r\n                        || attribute_preposition == \"equal\"\r\n                        || attribute_preposition == null)\r\n                        filter_obj[attribute_mapped] = {gte : attribute_quantity};\r\n                    else if(attribute_preposition == \"under\")\r\n                        filter_obj[attribute_mapped] = { gte:0,lte:attribute_quantity};\r\n                    console.log(\"Adding filter : \" + JSON.stringify(filter_obj,null,2));\r\n                    filter_list.push({'range':filter_obj});\r\n\r\n                    var  filter_attribute = {};\r\n                    filter_attribute[\"and\"] = filter_list;\r\n\r\n                    output = Helper.addPrevQuery(sessionId,\r\n                        {}, filter_attribute,\r\n                        spec_query, filter);\r\n\r\n                    spec_query = output[\"query\"];\r\n                    filter = output[\"filter\"];\r\n                    console.log(\"attribute filter completed.\");\r\n                }\r\n                else {\r\n                    console.log(\"best attribute phone\",context.attribute);\r\n                    spec_sort = Mappings.isSpecSortKeyExists(attribute) ? Mappings.specSortValue(attribute) : {};\r\n                    query = Mappings.isQueryExists(attribute) ? Mappings.queryValue(attribute): {};\r\n                    output = Helper.addPrevQuery(sessionId, query, {}, spec_query, filter);\r\n                    spec_query = output[\"query\"];\r\n                    console.log(spec_sort,spec_query);\r\n                    filter = output[\"filter\"];\r\n                    lContext.storeNewSessionKey(sessionId,\"feature_pref\",[attribute]);\r\n\r\n                    if(Mappings.isReasonExists(attribute))\r\n                        list_reason_message = Messages.messageKeyValue(\"listReason\",Mappings.getReasonMessage(attribute));\r\n                }\r\n            }\r\n            var  price_range_filter =  {'price': {'gte': localContext.sessionVars.start_price,\r\n                'lte': localContext.sessionVars.end_price}};\r\n            filter_list.push({'range':price_range_filter});\r\n        }\r\n\r\n         /*\r\n          *  completed DB query formation .....\r\n          */\r\n        if(list_reason_message)\r\n            lContext.storeNewKey(sessionId,\"list_reason_message\",list_reason_message);\r\n\r\n        var messages = [];\r\n        var output;\r\n\r\n        // check user asks in prev list or not..\r\n        if(Helper.isKeyExists(\"prev_list\",localContext) &&\r\n            !Helper.isKeyExists(\"prev_list_answer\",context) &&\r\n            !Helper.isKeyExists(\"list_synonyms\",context) &&\r\n            !Helper.isKeyExists(\"preference\",context)){\r\n            var option_message = {};\r\n            option_message[\"header\"] = Messages.listMessage(\"listQuestMessage\");\r\n            option_message[\"options\"] = [\"Yes\",\"No\"];\r\n            messages.push({type:\"buttons\",message:option_message});\r\n            lContext.storeNewKey(sessionId,\"prev_message\",\"listQuestMessage\");\r\n            cb(context,messages);\r\n            return ;\r\n        }\r\n\r\n        var is_prev_list_answer_exist = Helper.isKeyExists(\"prev_list_answer\",context) ||\r\n                                        Helper.isKeyExists(\"list_synonyms\",context);\r\n\r\n        if( Helper.isKeyExists(\"prev_list\",localContext) && is_prev_list_answer_exist ) {\r\n            var answer = context.prev_list_answer;\r\n\r\n            if(answer == \"yes\" || Helper.isKeyExists(\"list_synonyms\",context)){\r\n                console.log(\"prev list yes\");\r\n                var prev_spec_query = localContext.prev_list_query.spec_query;\r\n                var prev_filter = localContext.prev_list_query.filter;\r\n                var output =  Helper.addPrevQuery(sessionId,spec_query,filter, prev_spec_query, prev_filter);\r\n                spec_query = output[\"query\"];\r\n                filter = output[\"filter\"];\r\n\r\n                if(featureList.length > 0)\r\n                    feature = featureList[0];\r\n                else if( Helper.isKeyExists(\"intent\",context))\r\n                    feature = context.intent.toLowerCase().trim();\r\n\r\n                if( spec_query && Object.keys(spec_query).length == 0) spec_query = undefined;\r\n                if( spec_sort && Object.keys(spec_sort).length == 0) spec_sort = undefined;\r\n\r\n\r\n                var prev_list = localContext[\"prev_total_list\"];\r\n                var idList = localContext[\"prev_total_list_ids\"];\r\n                var newIdList = [];\r\n                for(var i=0;i<idList.length ;i++){\r\n                    newIdList.push(parseInt(idList[i]));\r\n                }\r\n\r\n                fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n\r\n                // console.log(fields);\r\n                if(query[\"bool\"] == null) query = {\"bool\":{\"must\":[{\"ids\":{\"values\":idList}}]}};\r\n                else query[\"bool\"][\"must\"].push({\"ids\" :{ \"values\" : idList}});\r\n\r\n                Search.findSpecMobile(sort,query,filter,fields, function (data) {\r\n                    Helper.storePrevQuery(sessionId,spec_sort,spec_query,filter);\r\n                    cb(context, Helper.printMessagesWhenPrevList(data.hits.hits,sessionId,feature));\r\n                });\r\n\r\n               // cb(context,msgs);\r\n                return;\r\n            }\r\n            else{\r\n                lContext.deleteKey(sessionId,\"prev_list_query\");\r\n                lContext.deleteKey(sessionId,\"prev_list\");\r\n                if(!Helper.isKeyExists(\"features\",context))\r\n                    lContext.deleteSessionKey(sessionId,\"feature_pref\");\r\n                lContext.deleteKey(sessionId,\"question_count\");\r\n            }\r\n        }\r\n\r\n        console.log(\"..................normal flow .........\");\r\n        console.log(localContext.sessionVars);\r\n\r\n        if(!Helper.isKeyExists(\"start_price\",localContext.sessionVars)){\r\n            messages.push({type:\"price\",message:Messages.listMessage(\"priceRange\")});\r\n            lContext.storeNewKey(sessionId, \"prev_message\", \"priceRangeMessage\");\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n        console.log(\" price range message ended.\");\r\n\r\n        // if the did not specify any feature , let him choose any of the feature\r\n        if(!Helper.isKeyExists(\"feature_pref\",localContext.sessionVars) &&\r\n            !Helper.isKeyExists(\"intent\",context)){\r\n            messages =  messages.concat(Helper.specMessage(sessionId,source));\r\n            cb(context,messages);\r\n            return;\r\n        } else {\r\n            if(Helper.isKeyExists(\"feature_pref\",localContext.sessionVars))\r\n                featureList = localContext.sessionVars.feature_pref;\r\n\r\n            var feature_user_case_question_key_list = [];\r\n            if(featureList.length > 0) {\r\n                for (var z = 0; z < featureList.length; z++) {\r\n                    var feature = featureList[z].toLowerCase();\r\n                    var use_case_questions = Messages.hasUseCaseQuests(feature) ?\r\n                        Messages.getUseCaseQuestions(feature) : undefined;\r\n                    if (use_case_questions != undefined) {\r\n                        var use_case_preference_keys = Object.keys(use_case_questions);\r\n                        feature_user_case_question_key_list =\r\n                            feature_user_case_question_key_list.concat(use_case_preference_keys);\r\n                    }\r\n                }\r\n            }\r\n            console.log(\"length \" , feature_user_case_question_key_list);\r\n            if(feature_user_case_question_key_list.length > 0  ) {\r\n\r\n                var question_count = feature_user_case_question_key_list.length;\r\n                if( question_count > 0 && !Helper.isKeyExists(\"question_count\",localContext)) {\r\n                    messages.push({type:\"text\",message:Messages.countMessages(question_count) });\r\n                    lContext.storeNewKey(sessionId, \"question_count\", \"yes\");\r\n                }\r\n\r\n                for (var i in feature_user_case_question_key_list) {\r\n                    var use_case_preference_key = feature_user_case_question_key_list[i];\r\n                    if (!Helper.isKeyExists(use_case_preference_key, localContext.sessionVars)) {\r\n                        console.log(\"use case questions for: \", feature + \" key is \" + use_case_preference_key);\r\n                        lContext.storeNewKey(sessionId, \"prev_message\", use_case_preference_key);\r\n                        var options = Messages.getUseCaseAnswer(use_case_preference_key);\r\n                        console.log(options);\r\n                        var header_question = options[\"header_question\"];\r\n                        var options_message = {};\r\n                        options_message[\"header\"] = header_question;\r\n\r\n                        if (options[\"type\"] == \"buttons\") {\r\n                            options_message[\"options\"] = options[\"questions\"];\r\n                            messages.push({type: \"buttons\", message: options_message});\r\n                        } else if (options[\"type\"] == \"checklist\") {\r\n                            options_message[\"checklist\"] = options[\"questions\"];\r\n                            options_message[\"max_select\"] = options[\"max_select\"];\r\n                            messages.push({type: \"checkList\", message: options_message})\r\n                        }\r\n                        lContext.storeNewSessionKey(sessionId, use_case_preference_key, \"nothing\");\r\n                        cb(context, messages);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log(\" DB QUERY FOR FIND PHONES\");\r\n        var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n        if( spec_query && Object.keys(spec_query).length == 0) spec_query = undefined;\r\n        if( spec_sort && Object.keys(spec_sort).length == 0) spec_sort = undefined;\r\n        //var specSortList = [];\r\n\r\n        var listMessages = [];\r\n\r\n        if(featureList.length == 1 || Helper.isKeyExists(\"intent\",context)) {\r\n            if(featureList.length == 1)\r\n                feature = featureList[0].toLowerCase();\r\n            else\r\n                feature = context.intent.toLowerCase().trim();\r\n            var sort = Mappings.isSpecSortKeyExists(feature) ? Mappings.specSortValue(feature) : undefined;\r\n            Search.findSpecMobile(sort,spec_query,filter,fields, function (data) {\r\n                Helper.storePrevQuery(sessionId,spec_sort,spec_query,filter);\r\n                cb(context, Helper.filterBrandPref(data.hits.hits,source, sessionId,feature,\"one\"));\r\n            })\r\n\r\n        }\r\n        else if( featureList.length > 1) {\r\n            var feature1 = featureList[0].toLowerCase();\r\n            var feature2 = featureList[1].toLowerCase();\r\n            Search.findSpecMobile(sort,spec_query,filter,fields, function (data) {\r\n                Helper.storePrevQuery(sessionId,spec_sort,spec_query,filter);\r\n                listMessages = listMessages.concat(Helper.filterBrandPref(data.hits.hits,\r\n                    source, sessionId, feature1,\"two\"));\r\n                Search.findSpecMobile(sort,spec_query,filter,fields, function (data) {\r\n                    Helper.storePrevQuery(sessionId,spec_sort,spec_query,filter);\r\n                    listMessages = listMessages.concat(Helper.filterBrandPref(data.hits.hits,\r\n                        source, sessionId,feature2,\"two\"));\r\n\r\n                    console.log(listMessages.length);\r\n\r\n                    messages.push({type:\"text\", message: \"Please scroll up to see the results\"});\r\n                    var listTypeMessages = [];\r\n                    for(var z=0;z<listMessages.length;z++){\r\n                        var msg = listMessages[z];\r\n                        if(msg[\"type\"] == \"list\"){\r\n                             listTypeMessages.push(msg[\"message\"]);\r\n                        }\r\n                        if(msg[\"type\"] == \"text\")\r\n                            messages.push(msg);\r\n                    }\r\n                    var bottom_message = \"Considering both the lists we have sorted the phones based on best \"+ feature1 + \" \" +\r\n                        \"and \"+ feature2;\r\n                    messages.push({type:\"text\",message:bottom_message});\r\n                    var combined_list =  Helper.processCombinedList(listTypeMessages,feature1,feature2);\r\n\r\n                    var relAttribute = Mappings.hasReleventAttriubte(feature1) ? Mappings.getRelevantAttribute(feature1) :[];\r\n                    relAttribute =  relAttribute.concat(Mappings.hasReleventAttriubte(feature2) ?\r\n                                                        Mappings.getRelevantAttribute(feature2) :[]);\r\n                    messages.push({type:\"list\",message: combined_list, relevant_attribute : relAttribute});\r\n\r\n                 //   console.log(\"entities_and_values list messages \",messages);\r\n                    cb(context,messages);\r\n\r\n                });\r\n            })\r\n        }\r\n      //  cb(context,listMessages);\r\n       // return;\r\n\r\n    },\r\n    ['sortPhoneList'](sessionId,context,source,cb){  // in two skus\r\n\r\n        console.log('sortPhonelist function running');\r\n        var localContext = lContext.userContext(sessionId);\r\n        var spec_sort = {};\r\n        var spec_query = {};\r\n        var filter = {};\r\n        var query;\r\n        var list_reason_message;\r\n\r\n        var present_context_keys = Object.keys(context);\r\n        var sort_key_list = [\"sim_type\",\"sim_size\",\"network_support\",\"camera_features\",\r\n            \"gps_type\",\"usb_type\",\"display_type\",\"gpu_type\",\"processor_core_type\",\"battery_type\",\r\n            \"audio_formats\",\"screen_protection\",\"sensor_type\",\"processor_type\",\"attribute\",\"features\"];\r\n\r\n        sort_key_list =  sort_key_list.filter(function(n) {\r\n            return present_context_keys.indexOf(n) != -1;\r\n        });\r\n\r\n        var key = context[sort_key_list[0]];\r\n        key = key.toLowerCase();\r\n\r\n        spec_sort  =  Mappings.isSpecSortKeyExists(key) ? Mappings.specSortValue(key) : undefined;\r\n        console.log(\"prev list yes\");\r\n        var prev_spec_query = localContext.prev_list_query.spec_query;\r\n        var prev_filter = localContext.prev_list_query.filter;\r\n        var output =  Helper.addPrevQuery(sessionId,spec_query,filter, prev_spec_query, prev_filter);\r\n        spec_query = output[\"query\"];\r\n        filter = output[\"filter\"];\r\n\r\n        if( spec_query && Object.keys(spec_query).length == 0) spec_query = undefined;\r\n        if( spec_sort && Object.keys(spec_sort).length == 0) spec_sort = undefined;\r\n\r\n        var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n        Search.findSpecMobile(spec_sort,spec_query,filter,fields, function (data) {\r\n            Helper.storePrevQuery(sessionId,spec_sort,spec_query,filter);\r\n            cb(context, Helper.printMessagesWhenPrevList(data.hits.hits, sessionId,key));\r\n        });\r\n    },\r\n    ['similarPhones'](sessionId,context,source,cb){\r\n        var model_name = context.sku;\r\n        var field = \"price\";\r\n        var messages = [];\r\n\r\n        Helper.getAttributeValueFromDB(field, model_name, function (result) {\r\n\r\n            var price = parseInt(result);\r\n            var sort = Mappings.specSortValue(\"overall\");\r\n            var query = undefined;\r\n            var filter = { 'range': { 'price': { 'gte': price - 5000, 'lte': price + 5000 } } };\r\n            var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n            Search.findSpecMobile(sort, query, filter,fields, function (data) {\r\n\r\n                var list = data.hits.hits;\r\n                if(list.length == 0){\r\n                    messages.push({type:\"text\",message:Messages.listMessage(\"notAvailable\")});\r\n                    cb(context,messages);\r\n                    return;\r\n                }\r\n\r\n                if(source == \"fb\") {\r\n                     list = list.slice(0, 7);\r\n                } else if(source == \"android\"){\r\n                    list = Helper.addFieldsToList(list);\r\n                }\r\n\r\n\r\n                // messages.push({ type: \"text\", message: Messages.listMessage(\"beforeList\") });\r\n                messages.push({ type: \"list\", message: list,relevant_attribute:[] });\r\n                // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n                messages.push({ type: \"text\", message: Messages.listMessage(\"afterList\") });\r\n                cb(context,messages);\r\n            });\r\n        });\r\n    },\r\n    ['findGenderMobile'](sessionId,context,source,cb){\r\n\r\n        var localContext = lContext.userContext(sessionId);\r\n        var messages = [];\r\n        if(!Helper.isKeyExists(\"start_price\",localContext.sessionVars)){\r\n            messages.push({type:\"price\",message:Messages.listMessage(\"priceRangeMessage\")});\r\n            lContext.storeNewKey(sessionId, \"prev_message\", \"priceRangeMessage\");\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n        if(!Helper.isKeyExists(\"age\",context)){\r\n            if(context.gender == \"female\")\r\n                messages.push({type:\"text\",message:Messages.listMessage(\"ageShe\")});\r\n            else if(context.gender == \"male\")\r\n                messages.push({type:\"text\",message:Messages.listMessage(\"ageHe\")});\r\n            else\r\n                messages.push({type:\"text\",message:Messages.listMessage(\"age\")});\r\n            lContext.storeNewKey(sessionId, \"prev_message\", \"agePrefMessage\");\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n        var sort;\r\n        if(context.gender == \"female\")\r\n            sort = Mappings.specSortValue(\"adult female\");\r\n        else if(context.gender  == \"male\")\r\n            sort = Mappings.specSortValue(\"adult male\");\r\n        else if(context.gender == \"kid\")\r\n            sort = Mappings.specSortValue(\"kids\");\r\n\r\n        var query = undefined;\r\n        var filter_list = [];\r\n        var price_range_filter = {'range': {'price': {'gte': localContext.sessionVars.start_price,\r\n            'lte': localContext.sessionVars.end_price}}};\r\n        filter_list.push(price_range_filter);\r\n\r\n        if(context.age < 15) {\r\n            var ram_filter = {'range': {'ram_memory': {'gte': 1}}};\r\n            filter_list.push(ram_filter);\r\n            var screen_size_filter = {'range': {'screen_size': {'lt': 4.5}}};\r\n            filter_list.push(screen_size_filter);\r\n            query = { bool:{ \"must_not\":[ {\"match\":{\"water_proof_rate\":\"no\"} }  ]} };\r\n        }\r\n        var filter = {};\r\n        filter[\"and\"] = filter_list;\r\n\r\n        var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n        console.log(sort,query,filter);\r\n        Search.findSpecMobile(sort,query,filter,fields,function(data){\r\n            var list = data.hits.hits;\r\n            if(list.length == 0){\r\n                messages.push({type:\"text\",message:Messages.listMessage(\"notAvailable\")});\r\n                cb(context,messages);\r\n                return;\r\n            }\r\n            if(source == \"fb\") {\r\n                list = list.slice(0, 7);\r\n                messages.push({type: \"list\", message: list});\r\n            }else if( source == \"android\") {\r\n                var newList = [];\r\n                for (var i = 0; i < list.length; i++)\r\n                    newList.push(list[i][\"fields\"]);\r\n                messages.push({type: \"list\", message: newList,relevant_attribute:[]});\r\n            }\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        });\r\n    },\r\n\r\n    // compare skus and sku specs and attributes\r\n    ['compareMobiles'](sessionId,context,source,cb){\r\n        var localContext = lContext.userContext(sessionId);\r\n        console.log(\"compare mobile specs\");\r\n        var key;\r\n        if(Helper.isKeyExists(\"features\",context))     key = context.features;\r\n        else if(Helper.isKeyExists(\"attribute\",context)) key = context.attribute;\r\n        else {\r\n            if(source == 'fb') key = \"phone\";\r\n            else key = \"skuAndroid\";\r\n        }\r\n\r\n        var model_names = [context.sku1,context.sku2];\r\n        console.log(localContext.sku1 + \" \" + localContext.sku2);\r\n        var messages = [];\r\n        var fields = [\"model_name\"];\r\n        console.log(\"Right file\");\r\n        var attribute_fields = Mappings.getFieldsAttribute(key);\r\n        console.log(attribute_fields);\r\n        fields = fields.concat(attribute_fields);\r\n\r\n\r\n        Helper.getFieldsFromDB(fields, model_names, function (compare_result) {\r\n\r\n            messages.push({ type: \"text\", message: Messages.listMessage(\"compare\") });\r\n            if(source ==\"fb\") {\r\n\r\n                messages.push({\r\n                    type: \"text\",\r\n                    message: Helper.separateKeyValueSKU(compare_result[0], fields, 0, fields.length)\r\n                });\r\n                messages.push({\r\n                    type: \"text\",\r\n                    message: Helper.separateKeyValueSKU(compare_result[1], fields, 0, fields.length)\r\n                });\r\n            }else if(source == \"android\")\r\n                if(key != \"skuAndroid\") {\r\n                    messages.push({\r\n                        type: \"text\",\r\n                        message: Helper.separateKeyValueSKU(compare_result[0], fields, 0, fields.length)\r\n                    });\r\n                    messages.push({\r\n                        type: \"text\",\r\n                        message: Helper.separateKeyValueSKU(compare_result[1], fields, 0, fields.length)\r\n                    });\r\n                }\r\n                messages.push({type:\"compare\",message:model_names});\r\n            // messages.push({type: \"text\", message: Messages.getBrowseMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        });\r\n    },\r\n    ['betterPhoneInTwo'](sessionId,context,source,cb){  // in two skus\r\n        var model_names = [context.sku1,context.sku2];\r\n        var map_key;\r\n        if(Helper.isKeyExists(\"features\",context))     map_key = context.features;\r\n        else if(Helper.isKeyExists(\"attribute\",context)) map_key = context.attribute;\r\n        else map_key = \"better\";\r\n        Helper.betterMobiles(map_key,model_names,function(messages){\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        });\r\n    },\r\n    ['betterThanSKU'](sessionId,context,source,cb){\r\n\r\n        var model_names = [context.sku];\r\n        var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n        var messages = [];\r\n\r\n        Helper.getFieldsFromDB(fields,  model_names, function (result_list) {\r\n            console.log(result_list);\r\n            var overall_score = parseFloat(result_list[0][\"overall_score\"]);\r\n            var price = result_list[0][\"price\"];\r\n            var specs = Mappings.specSortValue(\"price\");\r\n            var query = undefined;\r\n            var filter = { \"and\": [{\"range\": {\"overall_score\": { \"gte\": overall_score }}}]};\r\n\r\n            fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n            Search.findSpecMobile(specs, query, filter,fields, function (data) {\r\n                var list = data.hits.hits;\r\n                if(list.length == 0){\r\n                    messages.push({type:\"text\",message:Messages.listMessage(\"notAvailable\")});\r\n                    cb(context,messages);\r\n                    return;\r\n                }\r\n                Helper.storePrevQuery(sessionId,specs,query,filter);\r\n                if(source == \"fb\") {\r\n                    list = list.slice(0, 7);\r\n                    messages.push({type: \"list\", message: list});\r\n                }else if( source == \"android\") {\r\n                    var newList = [];\r\n                    for (var i = 0; i < list.length; i++)\r\n                        newList.push(list[i][\"fields\"]);\r\n                    messages.push({type: \"list\", message: newList,relevant_attribute : []});\r\n                }\r\n                // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n                cb(context,messages);\r\n            });\r\n        });\r\n    },\r\n\r\n    //  single sku question\r\n    ['getAttributeValueSKU'](sessionId,context,source,cb){\r\n        var messages = [];\r\n        var model_name = context.sku;\r\n        var attribute = context.attribute.toLowerCase();\r\n        var key = Mappings.isDbKeyExists(attribute) ? Mappings.getDbKey(attribute): undefined;\r\n        if (key == null) {\r\n            messages.push({ type: \"text\", message: Messages.listMessage(\"noInfo\") });\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n\r\n        Helper.getAttributeValueFromDB(key, model_name, function(data) {\r\n            var units = Mappings.isUnitExists(key) ? Mappings.getUnitKey(key) : \"\";\r\n            var knowledge_answer = Mappings.haveKnowledge(attribute) ?\r\n                Mappings.getKnowledge(attribute) : undefined;\r\n            var send_msg = data + \" \" + units + \"\\n\";\r\n\r\n            console.log(key);\r\n            if(Messages.doesHaveMessageForAttribute(key))\r\n                messages.push({ type: \"text\", message: Messages.getHeaderMessageForAttributeValue(key, context) });\r\n            if (context.attribute == 'rating') {\r\n                var rating = parseFloat(send_msg);\r\n                rating = rating.toFixed(2);\r\n                var message = Messages.ratingMessage(context.sku,rating);\r\n                messages.push({ type:\"text\", message:message});\r\n            }\r\n            else messages.push({ type: \"text\", message: send_msg });\r\n\r\n            if(knowledge_answer != undefined)\r\n                messages.push({ type:\"text\", message:knowledge_answer });\r\n            \r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context, messages);\r\n        });\r\n    },\r\n    ['singlePhoneDetails'](sessionId,context,source,cb){\r\n\r\n        var model_names = [context.sku];\r\n        var messages = [];\r\n        var fields = [\"model_name\"];\r\n        fields = fields.concat(Mappings.getFieldsAttribute(\"sku\"));\r\n        Helper.getFieldsFromDB(fields,model_names,function(result_list){\r\n            var output = Helper.separateKeyValueSKU(result_list[0],fields,0,fields.length);\r\n            messages.push({ type: \"text\", message: output});\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:model_names});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        });\r\n    },\r\n    ['specsOfSKU'](sessionId,context,source,cb){\r\n\r\n        console.log(\" running specsOfSku\");\r\n        var map_key;\r\n        var localContext = lContext.userContext(sessionId);\r\n        if(Helper.isKeyExists(\"features\",context)) map_key = context.features;\r\n        else if(Helper.isKeyExists(\"attribute\",context)) map_key = context.attribute;\r\n        else map_key = \"sku\";\r\n        var model_names = [context.sku];\r\n        var messages = [];\r\n        var fields = [\"model_name\"];\r\n        fields = fields.concat(Mappings.getFieldsAttribute(map_key));\r\n        console.log(\"fields :\" , fields);\r\n        Helper.getFieldsFromDB(fields,model_names,function(result_list){\r\n            var output = Helper.separateKeyValueSKU(result_list[0],fields,0,fields.length);\r\n            messages.push({ type: \"text\", message: output});\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:model_names});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    ['howSpecs'](sessionId,context,source,cb){\r\n        actions['specReview'](sessionId,context,source,cb);\r\n    },\r\n    [\"dimensionsSKU\"](sessionId,context,source,cb){\r\n        var fields = [\"model_name\",\"phone_height\",\"phone_width\",\"thickness\"];\r\n        var messages = [];\r\n        Helper.getFieldsFromDB(fields,[context.sku],function(result_list){\r\n            console.log(result_list[0]);\r\n            var output = Helper.separateKeyValueSKU(result_list[0], fields,0,fields.length);\r\n            messages.push({ type: \"text\", message: output });\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    ['specReview'](sessionId,context,source,cb){\r\n\r\n        var map_key;\r\n        if(Helper.isKeyExists(\"features\",context)) {\r\n             map_key = context.features.toLowerCase() + \" review\";\r\n        } else {\r\n            map_key = \"verdict\";\r\n        }\r\n\r\n        var messages = [];\r\n        var model_name = context.sku;\r\n        var key = Mappings.isDbKeyExists(map_key) ? Mappings.getDbKey(map_key) : undefined;\r\n        if (key == undefined) {\r\n            messages.push({ type: \"text\", message: Messages.listMessage(\"noInfo\") });\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n\r\n        Helper.getAttributeValueFromDB(key, model_name, function(data) {\r\n            \r\n            messages.push({ type: \"text\", message: data });\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context, messages);\r\n        });\r\n    },\r\n    ['SKUReview'](sessionId,context,source,cb){\r\n        var model_name = context.sku;\r\n        console.log(\"Start of SKUReview function\");\r\n        Helper.getAttributeValueFromDB('verdict_review', model_name, function(data) {\r\n            var review = data;\r\n            var messages = [];\r\n            \r\n            messages.push({ type: \"text\", message: review });\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context, messages);\r\n        });\r\n    },\r\n    ['checkAttributeSKU'](sessionId,context,source,cb){\r\n        var localContext = lContext.userContext(sessionId);\r\n        var messages = [];\r\n        var present_context_keys = Object.keys(context);\r\n        var knowledge_key_list = [\"sim_type\",\"network_support\",\"camera_features\",\r\n            \"gps_type\",\"usb_type\",\"display_type\",\"gpu_type\",\"processor_core_type\",\"battery_type\",\r\n            \"audio_formats\",\"screen_protection\",\"sensor_type\",\"processor_type\",\"attribute\"];\r\n\r\n        knowledge_key_list =  knowledge_key_list.filter(function(n) {\r\n            return present_context_keys.indexOf(n) != -1;\r\n        });\r\n        var has_units;\r\n        if(knowledge_key_list.length != 0){\r\n            var key = knowledge_key_list[0];\r\n            var value = context[knowledge_key_list[0]];\r\n            has_units = false;\r\n        }\r\n\r\n        if(Helper.isKeyExists(\"units\",context)){\r\n            key = Mappings.getDbKey(context.attribute.toLowerCase());\r\n            value = context.attribute_quantity;\r\n            has_units = true;\r\n        }\r\n\r\n        var fields = [\"model_name\", key];\r\n        var output;\r\n\r\n        Helper.getFieldsFromDB(fields, [context.sku], function (result_list) {\r\n\r\n            console.log(\"result list\", result_list);\r\n            if (has_units) {\r\n                var result = parseInt(result_list[0][key][0]);\r\n                value = parseInt(value);\r\n                console.log(typeof result, typeof value);\r\n                if (result == value) output = \"Yes\";\r\n                else output = \"No\";\r\n            } else {\r\n                var result = result_list[0][key][0].toLowerCase();\r\n                value = value.toLowerCase();\r\n                if (result.indexOf(value) > -1) output = \"Yes\";\r\n                else output = \"No\";\r\n            }\r\n\r\n            messages.push({ type: \"text\", message: output });\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        });\r\n    },\r\n    ['ratingMobile'](sessionId,context,source,cb){\r\n\r\n        var rating_field ;\r\n        if(context.platforms == \"flipkart\") rating_field=[\"average_rating_flipkart\",\"no_of_ratings_flipkart\"];\r\n        else if(context.platforms==\"amazon\") rating_field=[\"average_rating_amazon\",\"no_of_ratings_amazon\"];\r\n\r\n        Search.ratingPhone(context.platforms, rating_field,context.sku,function(data){\r\n            var rating =  (context.attribute === 'rating')? data.hits.hits[0][\"fields\"][rating_field[0]][0] :\r\n                data.hits.hits[0][\"fields\"][rating_field[1]][0];\r\n            if(rating == 0 ) rating = Messages.listMessage(\"noRating\");\r\n            rating = context.platforms + \" ratings for \" + context.sku +\" is \" +rating;\r\n            var messages = [];\r\n            messages.push({type:\"text\",message:rating });\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n\r\n        })\r\n    },\r\n    ['buyPhone'](sessionId,context,source,cb){\r\n\r\n        var localContext = lContext.userContext(sessionId);\r\n        Helper.getAttributeValueFromDB(\"purchase_url\",context.sku,function(data){\r\n            var messages = [];\r\n            messages.push({type:\"text\",message:data});\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    ['positiveSKU'](sessionId,context,source,cb){\r\n        Helper.getAttributeValueFromDB(\"pros\",context.sku,function(data){\r\n            var messages = [];\r\n            messages.push({type:\"text\",message:data});\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    ['negativeSKU'](sessionId,context,source,cb){\r\n        Helper.getAttributeValueFromDB(\"cons\",context.sku,function(data){\r\n            var messages = [];\r\n            messages.push({type:\"text\",message:data});\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    ['opinionSKU'](sessionId,context,source,cb){\r\n        var messages = [];\r\n        var fields = ['pros','cons',\"model_name\"];\r\n        Helper.getFieldsFromDB(fields,[context.sku],function(result_list){\r\n\r\n            var pros = \"Pros: \\n\" + result_list[0][\"pros\"][0];\r\n            var cons = \"Cons: \\n\" + result_list[0][\"cons\"][0];\r\n            var messages = [];\r\n            messages.push({type:\"text\",message:pros});\r\n            messages.push({type:\"text\",message:cons});\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    ['publicTalk'](sessionId,context,source,cb){\r\n        var messages = [];\r\n        var model_name = context.sku;\r\n        var key = \"user_review\";\r\n        if (key == null) {\r\n            messages.push({ type: \"text\", message: Messages.listMessage(\"noInfo\") });\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n\r\n        Helper.getAttributeValueFromDB(key, model_name, function(data) {\r\n            console.log(data);\r\n\r\n            var send_msg = data + \"  \\n\";\r\n            \r\n            messages.push({ type: \"text\", message: send_msg });\r\n            if(source == \"android\")\r\n                messages.push({type:\"sku\",message:[context.sku]});\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context, messages);\r\n        });\r\n    },\r\n\r\n    // knowledge questions\r\n    ['getAttributeValueALL'](sessionId,context,source,cb){\r\n        var model_names = [];\r\n        var localContext = lContext.userContext(sessionId);\r\n        var phone_list  =  localContext[\"user_shown_list\"];\r\n        for(var i=0;i<phone_list.length;i++)\r\n            model_names.push(phone_list[i][\"fields\"][\"model_name\"][0])\r\n        var messages = [];\r\n        var attribute = context.attribute.toLowerCase();\r\n        console.log(attribute);\r\n        var key = Mappings.isDbKeyExists(attribute) ? Mappings.getDbKey(attribute) : undefined;\r\n        console.log(\"key\");\r\n        if (key == undefined) {\r\n            messages.push({ type: \"text\", message: Messages.listMessage(\"noInfo\") });\r\n            cb(context,messages);\r\n            return;\r\n        }\r\n        var fields = [\"model_name\",key];\r\n        console.log(model_names);\r\n        Helper.getFieldsFromDB(fields, model_names, function (result_list) {\r\n            var send_msg = \"\";\r\n            var units = Mappings.isUnitExists(key) ? Mappings.getUnitKey(key) : \"\";\r\n\r\n            for(var k=0;k < model_names.length;k++) {\r\n                for (var j = 0; j < result_list.length; j++) {\r\n                    if( model_names[k] == result_list[j][\"model_name\"][0])\r\n                        send_msg += result_list[j][\"model_name\"][0] + \" : \" +\r\n                            result_list[j][key][0] + \" \" + units + \"\\n\";\r\n                }\r\n            }\r\n            console.log(\"sending message\", send_msg);\r\n            messages.push({ type: \"text\", message: send_msg });\r\n            // messages.push({type: \"text\", message: Messages.listMessage(\"scroll\")});\r\n            cb(context,messages);\r\n        });\r\n\r\n    },\r\n    ['knowledgeQuestion'](sessionId,context,source,cb){\r\n        var localContext = lContext.userContext(sessionId);\r\n        var messages = [];\r\n        var present_context_keys = Object.keys(context);\r\n        var knowledge_key_list = [\"sim_type\",\"sim_size\",\"network_support\",\"camera_features\",\r\n            \"gps_type\",\"usb_type\",\"display_type\",\"gpu_type\",\"processor_core_type\",\"battery_type\",\r\n            \"audio_formats\",\"screen_protection\",\"sensor_type\",\"processor_type\",\"attribute\"];\r\n\r\n        knowledge_key_list =  knowledge_key_list.filter(function(n) {\r\n            return present_context_keys.indexOf(n) != -1;\r\n        });\r\n\r\n        var key = context[knowledge_key_list[0]];\r\n        console.log(key.toLowerCase());\r\n        var knowledge_answer = Mappings.haveKnowledge(key.toLowerCase()) ?\r\n            Mappings.getKnowledge(key.toLowerCase()) : undefined;\r\n        if(knowledge_answer == undefined){\r\n            messages.push({type:\"text\",message:Messages.listMessage(\"notFound\")});\r\n            cb(context,messages);return;\r\n        }\r\n\r\n        messages.push({type:\"text\",message:knowledge_answer});\r\n        cb(context,messages);\r\n    },\r\n    ['bestAttributeInMarket'](sessionId,context,source,cb){\r\n\r\n        var messages = [];\r\n        var field_rank = {};\r\n        var localContext = lContext.userContext(sessionId);\r\n        var attribute_score ;\r\n        if(Mappings.hasSpecScores(context.attribute.toLowerCase()) ) {\r\n            attribute_score = Mappings.getSpecScores(context.attribute.toLowerCase());\r\n            field_rank[attribute_score] = 'desc';\r\n        } else if(Mappings.isHaveRank(context.attribute.toLowerCase())){\r\n            attribute_score = Mappings.getRank(context.attribute.toLowerCase());\r\n            field_rank[attribute_score] = 'asc';\r\n        } else {\r\n            messages.push({type:\"text\",message:Messages.listMessage(\"notFound\")});\r\n            cb(context,messages);return;\r\n        }\r\n\r\n        var key   =   Mappings.getDbKey(context.attribute.toLowerCase());\r\n        var units =   Mappings.isUnitExists(key)? Mappings.getUnitKey(key):\"\";\r\n        console.log(field_rank,key);\r\n\r\n        Search.getFieldRank(key,field_rank, function (data) {\r\n            var attribute_market  = data.hits.hits[0]['fields'][key][0];\r\n            var attribute_market1 = Messages.messageKeyValue(\"messageKeyValue\",context.attribute);\r\n            messages.push({type:\"text\",message:attribute_market +\" \"+units});\r\n            messages.push({type:\"text\",message:attribute_market1});\r\n            cb(context,messages);\r\n        })\r\n    },\r\n    [\"attributeList\"](sessionId,context,source,cb){\r\n\r\n        var messages  = [];\r\n        var attribute = context.attribute.toLowerCase();\r\n        var attribute_list = Mappings.isrankedAttributeExists(attribute) ? Mappings.getrankedAttribute(attribute): \"no\";\r\n        if(attribute_list !== \"no\"){\r\n            var message = \"\";\r\n            for(var i=0;i < 10;i++) message += (i+1) + \". \"+ attribute_list[i]+ \"\\n\";\r\n            messages.push({type:\"text\",message:attribute_list});\r\n            cb(context,messages);\r\n\r\n        }else{\r\n            messages.push({type:\"text\",message:Messages.listMessage(\"notFound\")});\r\n            cb(context,messages);\r\n        }\r\n    },\r\n\r\n    // text sending to user\r\n    ['greet'](sessionId,context,source,cb) {\r\n\r\n\r\n        var response =\"Hello\";\r\n        console.log(response);\r\n        var messages = [];\r\n        messages.push({type:\"text\",message:response});\r\n        cb(context,messages);\r\n    },\r\n    ['betterThanPhone'](sessionId,context,source,cb) {\r\n        var response = Messages.listMessage('presentSKUQuestion');\r\n        lContext.storeNewKey(sessionId,\"prev_message\",\"presentSKUQuestion\");\r\n        var messages = [];\r\n        messages.push({type:\"text\",message:response});\r\n        cb(context,messages);\r\n    },\r\n    ['posExpression'](sessionId,context,source,cb){\r\n\r\n        var msg = \":)\";\r\n        var messages = [];\r\n        messages.push({type:\"text\",message:msg });\r\n        cb(context,messages);\r\n    },\r\n    ['negExpression'](sessionId,context,source,cb){\r\n        var msg = Messages.listMessage(\"negExp\");\r\n        var messages = [];\r\n        messages.push({type:\"text\",message:msg });\r\n        cb(context,messages);\r\n    },\r\n    ['helpMessage'](sessionId,context,source,cb){\r\n        var messages =[];messages.push({type:\"text\",message:Messages.listMessage(\"help\")})\r\n        cb(context,messages);\r\n    },\r\n    ['trivia'](sessionId,context,source,cb){\r\n        var msg = Messages.triviaReply(context.trivia);\r\n        var messages =[];messages.push({type:\"text\",message:msg})\r\n        cb(context,messages);\r\n    },\r\n    ['complex_sentence'](sessionId,context,source,cb){\r\n        var msg = Messages.complexSentenceReply(context.complex_sentence);\r\n        var messages =[];messages.push({type:\"text\",message:msg});\r\n        cb(context,messages);\r\n    },\r\n    ['profanity'](sessionId,context,source,cb){\r\n        var message = \"That's not a proper language to use. \";\r\n        var messages =[];\r\n        messages.push({type:\"text\",message:message});\r\n        cb(context,messages);\r\n    },\r\n    ['destroyEverything'](sessionId , context, source, cb){\r\n        context = {};\r\n        console.log(\"new Context\");\r\n        console.log(context);\r\n        lContext.deleteContext(sessionId, function(data){\r\n            var messages = [];\r\n            if(source == \"fb\")\r\n                 messages.push({type:\"text\",message:Messages.listMessage(\"clear\")});\r\n            if(source == \"android\")\r\n                messages.push({type:\"clear\",message:Messages.listMessage(\"clear\")});\r\n            cb(context, messages);\r\n        });\r\n    },\r\n\r\n    //check sentence\r\n    ['checkSentence'](sessionId,context,source,cb){\r\n        console.log(\"check sentence in\");\r\n        var messages = [];\r\n        var localContext = lContext.userContext(sessionId);\r\n        Semantics.findSim(localContext.user_message, function (data) {\r\n            console.log(data);\r\n            if (data.status === true || data.status == 'check' ) {\r\n                console.log(\"yes\");\r\n                lContext.storeNewKey(sessionId,\"last_message\",data.sentence);\r\n                context = Helper.storeValInContext(context, \"checked_sentence\",\"Do you mean \\'\"\r\n                    + data.sentence +\"\\' Y / N \", true);\r\n                lContext.storeNewKey(sessionId,\"next_check_message\",\"yes\");\r\n                messages.push({type:\"text\",message:context.checked_sentence});\r\n                cb(context,messages);\r\n            }\r\n            else {\r\n                console.log(\"new error\");\r\n                //context = Helper.storeValInContext(context, \"check_message\", \"no\", false);\r\n                context = Helper.storeValInContext(context, \"checked_sentence\",Messages.listMessage(\"notFound\"),sessionId, false);\r\n                messages.push({type:\"text\",message:context.checked_sentence});\r\n                cb(context,messages);\r\n            }\r\n        })\r\n    }\r\n};\r\n\r\nfunction witProcessMessage(sessionId,message,email,source,context,callback){\r\n\r\n    if(!lContext.isSessionExists(sessionId))\r\n        lContext.createContext(sessionId);\r\n\r\n    var localContext = lContext.userContext(sessionId);\r\n    if(source == \"android\"){\r\n        var sendJson = {} ;\r\n        sendJson[\"username\"] = \"prodX\";\r\n        sendJson[\"message\"] = \"\";\r\n        var socket = global.getUserSocket(sessionId);\r\n    }\r\n\r\n    witAPIs.witMessageAPI(message,context,function(data){\r\n        var message_api_response = JSON.parse(data);\r\n        actions.merge(sessionId,context,message_api_response[\"entities\"],\r\n            message, function(result){\r\n                context = result[\"final_context\"];\r\n                console.log(\"result\",result);\r\n                var bot_function  = result[\"bot_function\"];\r\n\r\n                console.log(\"bot function in wit api\",bot_function);\r\n\r\n                if(bot_function == null){\r\n                    // no function to execute  // send sorry message..\r\n                    var messages = [{type:\"text\",message:Messages.listMessage(\"sorryMessage\")}];\r\n                    if(source == \"fb\"){\r\n                        actions.say(sessionId, context, messages);\r\n                    } else if(source ==\"android\"){\r\n                        sendJson[\"message\"] = [Messages.listMessage(\"sorryMessage\")];\r\n                        socket.emit(\"bot message\",sendJson);\r\n                    }\r\n                }\r\n\r\n                if(bot_function != \"findAllPhones\"){\r\n                    if(Helper.isKeyExists(\"prev_list\",localContext) ) {\r\n                        if (!Helper.isKeyExists(\"has_list_reference\", localContext)) {\r\n                            lContext.deleteKey(sessionId, \"prev_list\")\r\n                        } else {\r\n                            lContext.deleteKey(\"has_list_reference\",localContext);\r\n                        }\r\n                    }\r\n                }\r\n\r\n\r\n                try {\r\n                    actions[bot_function](sessionId, context, source, function (newContext, messages) {\r\n                        console.log(\"response after function\");\r\n                        if (lContext.question_message != \"yes\") {\r\n                            var localContext = lContext.userContext(sessionId);\r\n                            var pointer_message = Messages.getPointerMessage(localContext, bot_function, newContext, messages);\r\n                            var questionAsked = false;\r\n                            if (bot_function == \"findAllPhones\" || bot_function == \"findGenderMobile\" ||\r\n                                bot_function == \"betterThanSKU\") {\r\n                                if (localContext.prev_message == \"priceRangeMessage\" ||\r\n                                    localContext.prev_message == \"brandPrefMessage\" ||\r\n                                    localContext.prev_message == \"specPrefMessage\" ||\r\n                                    localContext.prev_message == \"listQuestMessage\" ||\r\n                                    localContext.prev_message == \"agePrefMessage\" ||\r\n                                    localContext.prev_message == \"front_camera_pref\" ||\r\n                                    localContext.prev_message == \"video_recording_pref\" ||\r\n                                    localContext.prev_message == \"photo_storage_pref\" ||\r\n                                    localContext.prev_message == \"gaming\" ||\r\n                                    localContext.prev_message == \"app_running\" ||\r\n                                    localContext.prev_message == \"spend_time\" ||\r\n                                    localContext.prev_message == \"network_type\" ||\r\n                                    localContext.prev_message == \"spend_time_battery\" ||\r\n                                    localContext.prev_message == \"after_battery_important\" ||\r\n                                    localContext.prev_message == \"record_videos\" ||\r\n                                    localContext.prev_message == \"after_camera_important\" ||\r\n                                    localContext.prev_message == \"frequent_use_activity\" ||\r\n                                    localContext.prev_message == \"use_phone_light\" ||\r\n                                    localContext.prev_message == \"relevant_internal_memory\" ||\r\n                                    localContext.prev_message == \"micro_sd_card_cost\") {\r\n                                    questionAsked = true;\r\n                                }\r\n                            }\r\n                            if (bot_function == \"betterThanPhone\")\r\n                                questionAsked = true;\r\n                            if (bot_function == \"destroyEverything\")\r\n                                questionAsked = true;\r\n\r\n                            if (Messages.getBrowseMessage(bot_function, context) != null && !questionAsked) {\r\n                                messages.push({\r\n                                    type: \"text\",\r\n                                    message: Messages.getBrowseMessage(bot_function, context)\r\n                                });\r\n                            }\r\n                            if (questionAsked == false) {\r\n                                messages.push({type: \"text\", message: pointer_message});\r\n                            }\r\n                        }\r\n\r\n                        var timestamp = moment().format('MMM DD, YYYY,h:mm:ss a');\r\n                        timestamp = (new Date).getTime();\r\n\r\n                        for (var j = 0; j < messages.length; j++) {\r\n                            if (messages[j].type == \"text\") {\r\n                                var content = messages[j]['message'];\r\n                                if (content == null || content == undefined)\r\n                                    content = \"  \";\r\n                                var details = {\r\n                                    'session_id': sessionId, 'sender': 'bot', 'content': content,\r\n                                    'username': email, 'timestamp': timestamp\r\n                                };\r\n                                db.inserttodB(details, \"chatapp_msg\");\r\n                            }\r\n                        }\r\n                        if (source == \"fb\") {\r\n                            for (var i = 0; i < messages.length; i++) {\r\n                                if (messages[i][\"type\"] === \"list\") {\r\n                                    var phone_list = messages[i][\"message\"];\r\n                                    messages[i][\"message\"] = Helper.makeListFBFormat(phone_list)\r\n                                }\r\n                            }\r\n                            actions.say(sessionId, newContext, messages);\r\n\r\n                        } else if (source == \"android\") {\r\n\r\n                            socket.emit(\"bot pointers\", {\"pointers\": Messages.getPointers(localContext, bot_function, newContext, messages)});\r\n                            var textMessages = [];\r\n                            var timestamp = moment().format('MMM DD, YYYY,h:mm:ss a');\r\n                            for (var j = 0; j < messages.length; j++) {\r\n                                if (messages[j].type == \"text\") {\r\n                                    textMessages.push(messages[j][\"message\"]);\r\n                                }\r\n                            }\r\n                            sendJson[\"message\"] = textMessages;\r\n                            socket.emit(\"bot message\", sendJson);\r\n\r\n                            for (var i = 0; i < messages.length; i++) {\r\n                                var msg = messages[i];\r\n                                sendJson[\"message\"] = msg[\"message\"];\r\n\r\n                                if (msg.type == \"list\") {\r\n                                    sendJson[\"relevant_attribute\"] = msg[\"relevant_attribute\"];\r\n                                    socket.emit(\"bot list\", sendJson);\r\n                                } else if (msg.type == \"compare\") {\r\n\r\n                                    var model_names = msg[\"message\"];\r\n                                    var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n                                    Helper.getFieldsFromDB(fields, model_names, function (result_list) {\r\n                                        var obj = {};\r\n                                        obj[\"mobile1\"] = result_list[0];\r\n                                        obj[\"mobile2\"] = result_list[1];\r\n                                        sendJson[\"message\"] = obj;\r\n                                        socket.emit(\"bot compare\", sendJson);\r\n                                    });\r\n\r\n                                } else if (msg.type == \"sku\") {\r\n\r\n                                    var model_names = msg[\"message\"];\r\n                                    var fields = Mappings.getFieldsAttribute(\"skuAndroid\");\r\n                                    Helper.getFieldsFromDB(fields, model_names, function (result_list) {\r\n                                        sendJson[\"message\"] = result_list[0];\r\n                                        socket.emit(\"bot sku\", sendJson);\r\n                                    });\r\n\r\n                                } else if (msg.type == \"clear\") {\r\n                                    socket.emit(\"bot clear\", sendJson);\r\n                                } else if (msg.type == \"buttons\") {\r\n                                    sendJson[\"message\"] = msg[\"message\"];\r\n                                    socket.emit(\"bot buttons\", sendJson);\r\n                                } else if (msg.type == \"checkList\") {\r\n                                    sendJson[\"message\"] = msg[\"message\"];\r\n                                    socket.emit(\"bot checkList\", sendJson);\r\n                                } else if (msg.type == \"price\") {\r\n                                    sendJson[\"message\"] = msg[\"message\"];\r\n                                    socket.emit(\"bot price\", sendJson);\r\n                                }\r\n                            }\r\n                            console.log(\"all messages sent\")\r\n                        }\r\n                    });\r\n                }catch(error){\r\n\r\n                    console.log(\" ERROR IN SUB FUNCTION SEE THAT \");\r\n\r\n                    sendJson[\"message\"] = [\"Unable to process the question. Please rephrase it.\"];\r\n                  //  socket.emit(\"bot message\", sendJson);\r\n                    console.log(error)\r\n                }\r\n        });\r\n    });\r\n}\r\n\r\nfunction wordInString(s, word){\r\n    return new RegExp( '\\\\b' + word + '\\\\b', 'i').test(s);\r\n}\r\n\r\nmodule.exports ={\r\n    witProcessMessage:witProcessMessage\r\n\r\n};\r\n// bot testing mode\r\n// http://stackoverflow.com/questions/6398196\r\nif (require.main === module) {\r\n    console.log(\"Bot testing mode.\");\r\n    const client = getWit();\r\n    client.interactive();\r\n}\r\n"]}