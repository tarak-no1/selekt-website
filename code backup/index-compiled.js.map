{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\r\n\r\n// Messenger API integration example\r\n// We assume you have:\r\n// * a Wit.ai bot setup (https://wit.ai/docs/quickstart)\r\n// * a Messenger Platform setup (https://developers.facebook.com/docs/messenger-platform/quickstart)\r\n// You need to `npm install` the following dependencies: body-parser, express, request.\r\n\r\nconst bodyParser = require('body-parser');\r\nconst express = require('express');\r\nvar moment=require('moment');\r\n\r\n// get Bot, const, and Facebook API\r\nconst bot = require('./bot.js');\r\nconst Config = require('./../config/const.js');\r\nconst FB = require('./facebook.js');\r\nconst Sessions = require('./sessions.js');\r\nconst sentenceParser = require('./cleanSentence');\r\nconst lContext =  require('./localContexts.js');\r\nconst db=require('./pushintodb.js');\r\n\r\n// Web server parameter\r\nconst PORT = process.env.PORT || 8889;\r\n\r\n// Starting our webserver and putting it all together\r\nconst app = express();\r\napp.set('port', PORT);\r\napp.listen(app.get('port'));\r\napp.use(bodyParser.json());\r\nconsole.log(\"I'm wating for you @\" + PORT);\r\n\r\n// index. Let's say something fun\r\napp.get('/', function(req, res) {\r\n  res.send('\"Only those who will risk going too far can possibly find out how far one can go.\" - T.S. Eliot');\r\n});\r\n\r\n// Webhook verify setup using FB_VERIFY_TOKEN\r\napp.get('/webhook', function(req, res)  {\r\n  if (!Config.FB_VERIFY_TOKEN) {\r\n    throw new Error('missing FB_VERIFY_TOKEN');\r\n  }\r\n  if (req.query['hub.mode'] === 'subscribe' &&\r\n      req.query['hub.verify_token'] === Config.FB_VERIFY_TOKEN) {\r\n    res.send(req.query['hub.challenge']);\r\n  } else {\r\n    res.sendStatus(400);\r\n  }\r\n});\r\n\r\napp.get('/version', function(req, res)  {\r\n  var obj = {};\r\n  obj[\"version\"] = 20;\r\n  var stencilMessages = [];\r\n  stencilMessages.push({sender:\"user\",message: \" You: Hi\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: Hello\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: I need a phone\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: Before showing you the results,\" +\r\n  \" let me ask you three simple questions to know your preferences better.\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: what is the price range you are looking for ?\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: around 20 thousand\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: I have got 14 phones in this price range\" +\r\n  \"1. Sony(3)\\n\" +\r\n  \"2. HTC Mobiles(3)\\n\" +\r\n  \"3. Samsung(2)\\n\" +\r\n  \"4. One plus(2)\\n\" +\r\n  \"5. Apple(1)\\n\" +\r\n  \"6. Lenovo(1)\\n\" +\r\n  \"7. Google Mobile(1)\\n\" +\r\n  \"8. Motorola(1)\\n\" +\r\n  \"If you want to filter out any of these brands, just type the corresponding number or type '0' to skip.\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: 6 7  1\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: Which of the following features is most important\" +\r\n  \" to you ? Pick the corresponding number.\" +\r\n  \"1. Camera\\n\" +\r\n  \"2. Display\\n\" +\r\n  \"3. Battery\\n\" +\r\n  \"4. RAM\\n\" +\r\n  \"5. All\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: 1\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: list size: 9: \" +\r\n  \"Results are sorted based on camera specifications and expert camera reviews.\" +\r\n  \"See below for your recommendations\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: compare phones 1 and 2\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: By comparing the specification scores from 'buysmaart.com' for both of these mobiles, Apple iPhone 5s seems to be better than\" +\r\n  \" HTC Mobiles Desire 828 Dual SIM. See below for more details\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: what's the ram of oneplus two\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: 4 GB\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: Compare Moto X and oneplus two\"});\r\n  stencilMessages.push({sender:\"prodx\",message: \"ProdX: By comparing the specification scores from 'buysmaart.com' for both of these mobiles, Oneplus two seems to be better than Motorola Moto X Play 32 GB.\" +\r\n  \"See below for more details\"});\r\n  stencilMessages.push({sender:\"user\",message: \"You: show me full details of oneplus two\"});\r\n  \r\n  obj[\"messages\"] = stencilMessages;\r\n  res.send(obj);\r\n});\r\n\r\napp.get('/intro1', function(req, res)  {\r\n  var obj = {};\r\n  obj[\"title\"] = \" What is ProdX?\";\r\n  var introPointers = [];\r\n  introPointers.push(\"Suggest phones for my daughter\");\r\n  introPointers.push(\"Mobiles popular for gaming under 15k\");\r\n  introPointers.push(\"Phones that can take awesome selfies\");\r\n  introPointers.push(\"Mobile that charge fast\");\r\n  obj[\"messages\"] = introPointers;\r\n  res.send(obj);\r\n});\r\n\r\napp.get('/intro2', function(req, res)  {\r\n  var obj = {};\r\n  obj[\"title\"] = \" How it works?\";\r\n  var introPointers = [];\r\n  introPointers.push(\"Type your query in the chat window in simple sentences\");\r\n  introPointers.push(\"Scroll up and you can browse through the results\");\r\n  introPointers.push(\"Use prompts to see the popular questions\");\r\n  introPointers.push(\"Type 'clear' to start a new chat session\");\r\n  obj[\"messages\"] = introPointers;\r\n  res.send(obj);\r\n});\r\n\r\napp.get('/intro3', function(req, res)  {\r\n  var obj = {};\r\n  obj[\"title\"] = \" What all can it do?\";\r\n  var introPointers = [];\r\n  introPointers.push(\"Recommend a List of mobile phones based on your requirements, purpose and budget\");\r\n  introPointers.push(\"Features of any particular model\");\r\n  introPointers.push(\"Meaning and definitions of mobile terminologies (eg. What is RAM ?)\");\r\n  introPointers.push(\"Compare features of two mobiles and recommend the better one\");\r\n  introPointers.push(\"Expert reviews\");\r\n  obj[\"messages\"] = introPointers;\r\n  res.send(obj);\r\n});\r\n\r\napp.get('/introMessages', function(req, res)  {\r\n  var list =[];\r\n\r\n  var obj = {};\r\n  obj[\"title\"] = \" What is ProdX?\";\r\n  obj[\"page\"] = \"first\";\r\n  var introPointers = [];\r\n  introPointers.push(\"Suggest phones for my daughter\");\r\n  introPointers.push(\"Mobiles popular for gaming under 15k\");\r\n  introPointers.push(\"Phones that can take awesome selfies\");\r\n  introPointers.push(\"Mobile that charge fast\");\r\n  obj[\"messages\"] = introPointers;\r\n  list.push(obj);\r\n\r\n  var obj = {};\r\n  obj[\"title\"] = \" How it works?\";\r\n  obj[\"page\"] =\"second\";\r\n  var introPointers = [];\r\n  introPointers.push(\"Type your query in the chat window in simple sentences\");\r\n  introPointers.push(\"Scroll up and you can browse through the results\");\r\n  introPointers.push(\"Use prompts to see the popular questions\");\r\n  introPointers.push(\"Type 'clear' to start a new chat session\");\r\n  obj[\"messages\"] = introPointers;\r\n  list.push(obj);\r\n\r\n  var obj = {};\r\n  obj[\"title\"] = \" What all can it do?\";\r\n  obj[\"page\"] = \"third\";\r\n\r\n  var introPointers = [];\r\n  introPointers.push(\"Recommend a List of mobile phones based on your requirements, purpose and budget\");\r\n  introPointers.push(\"Features of any particular model\");\r\n  introPointers.push(\"Meaning and definitions of mobile terminologies (eg. What is RAM ?)\");\r\n  introPointers.push(\"Compare features of two mobiles and recommend the better one\");\r\n  introPointers.push(\"Expert reviews\");\r\n  obj[\"messages\"] = introPointers;\r\n  list.push(obj);\r\n\r\n  var obj = {};\r\n  obj[\"title\"] = \"What it cannot do?\";\r\n  obj[\"page\"] = \"fourth\";\r\n\r\n  var introPointers = [];\r\n  introPointers.push(\"Avoid using combined sentences \\n   eg: I want phones around 10k but with a 13 MP camera\");\r\n  introPointers.push(\"Do not use negative words \\n  eg: Don�t, doesn't, can't, not\");\r\n  introPointers.push(\"Rephrase your question in case ProdX doesn�t give you an expected response\");\r\n  introPointers.push(\"    You: How's Oneplus one?\");\r\n  introPointers.push(\"    ProdX: I'm not able to understand that.\");\r\n  introPointers.push(\"    You: Review of Oneplus one\");\r\n  introPointers.push(\"    ProdX: Oneplus one is a very good phone that comes at a very affordable price ...\");\r\n  obj[\"messages\"] = introPointers;\r\n  list.push(obj);\r\n\r\n  res.send(obj);\r\n});\r\n\r\n\r\nfunction witFunction(sessionId,msg){\r\n\r\n  bot.witProcessMessage(sessionId,msg,sessionId,\"fb\",{},function(result){\r\n  });\r\n}\r\n// The main message handler\r\napp.post('/webhook',function (req, res)  {\r\n  // Parsing the Messenger API response\r\n  const messaging = FB.getFirstMessagingEntry(req.body);\r\n\r\n\r\n  if(messaging.postback ){\r\n    console.log(\"postback occurred\");\r\n    var  text = JSON.stringify(messaging.postback);\r\n    console.log(text);\r\n  }\r\n\r\n  if (messaging && messaging.message) {\r\n\r\n    // Yay! We got a new message!\r\n\r\n    // We retrieve the Facebook user ID of the sender\r\n    const sender = messaging.sender.id;\r\n\r\n    // We retrieve the user's current session, or create one if it doesn't exist\r\n    // This is needed for our bot to figure out the conversation history\r\n    const sessionId = Sessions.findOrCreateSession(sender);\r\n\r\n\r\n    // We retrieve the message content\r\n    var  msg = messaging.message.text;\r\n    const atts = messaging.message.attachments;\r\n\r\n    var timestamp=moment().format('MMM DD, YYYY,h:mm:ss a');\r\n    timestamp = (new Date).getTime();\r\n\r\n    // db.inserttodB({'name':sender},'chatapp_user');\r\n    var details={'session_id':sessionId,'sender':sender,'content':msg,'username':sessionId,timestamp:timestamp};\r\n    db.inserttodB(details,\"chatapp_msg\");\r\n\r\n    if(!lContext.isSessionExists(sessionId))\r\n      lContext.createContext(sessionId);\r\n    var localContext = lContext.userContext(sessionId);\r\n\r\n    if (atts) {\r\n      // We received an attachment\r\n      // Let's reply with an automatic message\r\n      FB.fbMessage(sender,'Sorry I can only process text messages for now.');\r\n    } else if (msg) {\r\n      // We received a text message\r\n      // message may have typos check them\r\n      sentenceParser.cleanSentence(msg, function (clean_message) {\r\n        console.log(\"Cleaned messaged : \"+ JSON.stringify(clean_message));\r\n        witFunction(sessionId,clean_message);\r\n      })\r\n    }\r\n  }\r\n  res.sendStatus(200);\r\n});\r\n"]}